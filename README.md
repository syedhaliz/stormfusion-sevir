# StormFusion-SEVIR

> **⚡ RESUMING WORK? → [START HERE](START_HERE.md)** ← Quick resume guide (last updated Oct 17, 2025)

A staged, **simple→complex** research framework for precipitation nowcasting and synthetic radar generation on **SEVIR**,
with an engineered path to **new architectures** and **new modalities**.

> **Why this repo?** We want a reproducible scaffold that an AI code agent can extend incrementally—
start with tiny data and a minimal U-Net, then layer losses, temporal modeling, attention/Transformers, GANs,
and eventually multimodal fusion with additional GOES-16 ABI/GLM channels and other sources.

**Key ideas**
- Small-to-large **data regimen** (tiny→subset→full), with gating metrics and unit tests.
- Simple-to-novel **architecture ladder** (persistence/OF baselines → U-Net → ConvLSTM/ConvGRU → attention U-Net →
  Spatiotemporal Transformer (Swin/ViT-like) → diffusion/GAN hybrids).
- **Evaluation you can trust**: forecast metrics (CSI, POD, SUCR, BIAS) and perceptual metrics (LPIPS/SSIM), plus qualitative triplets.
- **Agent-operable instructions** under `docs/AGENT_TASKS/` to auto-generate notebooks per stage.

> This scaffold targets **PyTorch**. It ships with runnable baselines on a tiny split and tests that exercise data, models, and metrics.

---

## Quick start (local)

```bash
# 1) Create environment (pip)
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt

# Optional: pre-commit for linting
pip install pre-commit && pre-commit install

# 2) Verify install
pytest -q

# 3) Run a smoke train on the tiny split (dummy random tensors or sample HDF5 if present)
python scripts/train.py --config configs/base.yaml --data.tiny=true --max_steps=20

# 4) Evaluate on tiny val
python scripts/evaluate.py --config configs/base.yaml --data.tiny=true
```

## Data (SEVIR)

- This repo expects the **SEVIR catalog** and HDF5 event files to be available locally or via a mounted path. See `data/README.md`.
- Tiny/subset splits are text files with event IDs in `data/samples/`.
- For extended modalities beyond the original SEVIR (more ABI bands, GLM features), see `docs/DATA_ENHANCEMENT.md`.

> Background: SEVIR provides ~10k four-hour events (49 time steps @ 5 min) across ABI C02/C09/C13, VIL radar mosaics, and GLM flashes; images are
aligned on 384 km patches at sensor-native resolutions. This scaffold reuses those conventions and metrics.  

Refs: Veillette et al., *NeurIPS 2020 Datasets and Benchmarks* (SEVIR).

## Progress Tracker

### Stage 0: Environment Setup ✅
- PyTorch environment configured
- SEVIR data pipeline validated
- Tests passing

### Stage 1: Data Pipeline ✅
- Tiny dataset (8 train / 4 val events)
- Data loading and preprocessing
- Basic metrics implemented

### Stage 2: Baseline U-Net ✅
- 2D U-Net with MSE loss
- CSI@74 = 0.68 on tiny dataset
- Baseline established

### Stage 3: ConvLSTM Temporal Modeling ✅
- Encoder-decoder with temporal recurrence
- CSI@74 = 0.73 on tiny dataset
- Motion patterns captured

### Stage 4: Perceptual Loss + Data Scaling ✅ **MAJOR BREAKTHROUGH**
- **Problem:** Extreme event catastrophic failure (CSI@181=0.16, CSI@219=0.08)
- **Root cause:** Data scarcity (60 events insufficient)
- **Solution:** Scale to ALL 541 SEVIR events (432 train / 109 val)
- **Results:**
  - CSI@74 = 0.82 (moderate weather) ✅
  - CSI@181 = 0.50 (extreme weather, +212% improvement!) ✅
  - CSI@219 = 0.33 (hail, +318% improvement!) ✅
  - LPIPS = 0.137 (sharp predictions)
- **Key insight:** Pure MSE with sufficient data outperforms perceptual loss
- **See:** `docs/STAGE4_BREAKTHROUGH.md` for full analysis

### Stage 5: Multi-Step Forecasting (Next)
- Extend to 6 time steps (5-30 min ahead)
- Maintain sharpness over forecast horizon
- Use 541-event dataset as standard

---

## Experiments

- The full staged plan is in `docs/EXPERIMENT_PLAN.md` and the **architecture ladder** in `docs/ARCHITECTURE_LADDER.md`.
- Each stage has an agent-readable task file in `docs/AGENT_TASKS/` that will generate or extend notebooks in `notebooks/`.
- **Latest:** Stage 4 breakthrough documented in `docs/STAGE4_BREAKTHROUGH.md`

## Repro & structure

```
stormfusion-sevir/
  ├─ stormfusion/                 # Python package
  ├─ configs/                     # YAML configs
  ├─ scripts/                     # CLI entry points
  ├─ docs/                        # Plans + agent tasks
  ├─ data/                        # local data pointers & tiny splits
  ├─ notebooks/                   # auto-generated by the agent (templates provided)
  ├─ tests/                       # lightweight unit tests
  └─ .github/workflows/ci.yml     # lint + tests
```

## License

This scaffold is MIT-licensed. **Datasets have their own licenses;** ensure your usage complies with SEVIR and any source you add.

## Citation

If you use this scaffold in a publication, please cite SEVIR and the GOES-16 ABI documentation; see `docs/EVAL_METRICS.md` and `docs/DATA_ENHANCEMENT.md` for references.
